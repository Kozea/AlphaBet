<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
  </head>

  <header>
    <h1>AlphaBet</h1>
    <aside>
      {% if session['logged_in'] %}
        <p>Vous êtes connectés en tant que {{ session['user'] }} !</p>
        <form action="/logout">
          <input type="submit" value="Se deconnecter" />
        </form>
			{% else %}
        {% for message in get_flashed_messages() %}
          <div class=flash>{{ message }}</div>
        {% endfor %}
        <form action="/login" method="post">
          <label>Identifiant
            <input name="username" />
          </label>
          <label>Mot de passe
            <input type="password" name="password" />
          </label>
          <input type="submit" value="Se connecter" />
        </form>
      {% endif %}
    </aside>
  </header>
  <main>
   {% if session['logged_in'] %}
    <nav>
      <form method="get">
        <label>Journée
          <select name="matchday">
          {% for i in range(1, numberofmatchdays+1) %}
            {% if i == currentmatchday %}
              <option value="{{ i }}" selected>Journée {{ i }} </option>
            {% else %}
              <option value="{{ i }}">Journée {{ i }}</option>
            {% endif %}
          {% endfor %}
          </select>
        </label>
        <label>Utilisateur
          <select name="username">
          {% for user in users %}
            {% if user[0] == currentuser %}
              <option value="{{ user[0] }}" selected>{{ user[0] }}</option>
            {% else %}
              <option value="{{ user[0] }}">{{ user[0] }}</option>
            {% endif %}
          {% endfor %}
          </select>
        </label>
        <input type="submit" value="Envoyer">
      </form>
    </nav>
    <h2>Journée {{ matchdaynumber }} de la {{ competitions }}</h2>
    {% for fixture_data in fixtures_datas %}
      {% if fixture_data["matchday"] == matchdaynumber %}
        <h3>{{ fixture_data["Date"] }}</h3>
        <h4>{{ fixture_data["homeTeamName"] }} - {{ fixture_data["awayTeamName"] }}</h4>
        <dl>
          <dt>Heure</dt>
          <dd>{{ fixture_data["Time"] }}</dd>
          <dt>Score</dt>
          <dd>{{ fixture_data["result"]["goalsHomeTeam"] }} - {{ fixture_data["result"]["goalsAwayTeam"] }}</dd>
        </dl>      
        {% if (session['logged_in']) and ((fixture_data["status"] == 'TIMED') or (fixture_data["status"] == 'SCHEDULED')) %}
          {% if (urlusername == session['user']) and (fixture_data["id"] not in resultset) %}
            <form action="{{ url_for('bet', match_id=fixture_data['id']) }}" method="post">
              <label>
                <input type="radio" name="result" value="home" />
                Domicile
              </label>
              <label>
                <input type="radio" name="result" value="draw" />
                Nul
              </label>
              <label>
                <input type="radio" name="result" value="away" />
                Extérieur
              </label>
              <input type="submit" value="Envoyer">
            </form>
          {% elif (urlusername == session['user']) and (fixture_data["id"] in resultset) %}
            <form action="" method="post">
              <label>
                {% if resultbet[resultset.index(fixture_data["id"])] == 'home' %}
                  <input type="radio" name="result" value="home" checked="checked">
                  Domicile
                {% else %}
                  <input type="radio" name="result" value="home" disabled="disabled">
                  Domicile
                {% endif %}
              </label>
              <label>
                {% if resultbet[resultset.index(fixture_data["id"])] == 'draw' %}
                  <input type="radio" name="result" value="draw" checked="checked"/>
                  Nul
                {% else %}
                  <input type="radio" name="result" value="draw" disabled="disabled">
                  Nul
                {% endif %}
              </label>
              <label>
                {% if resultbet[resultset.index(fixture_data["id"])] == 'away' %}
                  <input type="radio" name="result" value="away" checked="checked"/>
                  Extérieur
                {% else %}
                  <input type="radio" name="result" value="away" disabled="disabled">
                  Extérieur
                {% endif %}
              </label>
            </form>
          {% elif (urlusername != session['user']) and (fixture_data["id"] in resultset) %}
            <form action="" method="post">
              <label>
                {% if resultbet[resultset.index(fixture_data["id"])] == 'home' %}
                  <input type="radio" name="result" value="home" checked="checked">
                  Domicile
                {% else %}
                  <input type="radio" name="result" value="home" disabled="disabled">
                  Domicile
                {% endif %}
              </label>
              <label>
                {% if resultbet[resultset.index(fixture_data["id"])] == 'draw' %}
                  <input type="radio" name="result" value="draw" checked="checked"/>
                  Nul
                {% else %}
                  <input type="radio" name="result" value="draw" disabled="disabled">
                  Nul
                {% endif %}
              </label>
              <label>
                {% if resultbet[resultset.index(fixture_data["id"])] == 'away' %}
                  <input type="radio" name="result" value="away" checked="checked"/>
                  Extérieur
                {% else %}
                  <input type="radio" name="result" value="away" disabled="disabled">
                  Extérieur
                {% endif %}
              </label>
            </form>
          {% else %}
            <form action="" method="post">
              <label>
                <input type="radio" name="result" value="home" disabled="disabled">
                Domicile
              </label>
              <label>
                <input type="radio" name="result" value="draw" disabled="disabled"/>
                Nul
              </label>
              <label>
                <input type="radio" name="result" value="away" disabled="disabled"/>
                Extérieur
              </label>
            </form>
          {% endif %}
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}
  </main>
</html>
